import{b as t,_ as e}from"./index-Yx4e-zaU.js";/* empty css                    */import{B as a}from"./BREAK-Z94lMw7a.js";import{a as l,u as o}from"./vue-router-Nb642-En.js";import{b as s,v as r,w as i,d as c,c as u}from"./element-plus-ibTVCnbi.js";import{d,b as n,r as v,o as h,w as k,q as p,l as f,W as b,u as y,_ as x,m,t as A,V as E,a7 as T,F as g,ah as _,Z as j,ak as O,al as w}from"./vue-n1z6Fgex.js";import"./vue-i18n-kmt_8FQk.js";const C=t=>(O("data-v-7a63f592"),t=t(),w(),t),I={style:{border:"#efefef solid 1px",height:"calc(100vh - 150px)",width:"100%"}},R=["onDblclick","onContextmenu","innerHTML"],D={class:"filter-pane",id:"node-filter-pane"},P=C((()=>A("h2",null,"节点筛选：",-1))),V={class:"filter-pane",id:"line-filter-pane"},H=C((()=>A("h2",null,"关系筛选：",-1))),L=C((()=>A("span",{class:"el-dropdown-link"},null,-1)));var S=(t=>(t.risk="risk",t.avoidance="avoidance",t.attackTool="attack-tool",t.threatActor="threat-actor",t.abilityProvider="ability-provider",t.all="all",t.openAsRoot="open-as-root",t))(S||{}),N=(t=>(t.risk="orange",t.avoidance="green",t.attackTool="blue",t.threatActor="red",t.abilityProvider="purple",t))(N||{});const B=e(d({__name:"RelationView",setup(e){const d=l(),O=o(),w=n(d.params.type),C=n(d.params.key),B=n(),J={allowShowMiniToolBar:!0,disableZoom:!1,disableDragCanvas:!1,defaultExpandHolderPosition:"right",defaultShowLineLabel:!0,layout:{layoutName:"center",distance_coefficient:2}},M=v([]),U=v([]),z=v({rootId:C.value,nodes:M,lines:U}),F=()=>{let t;switch(w.value){case"risk":{let e=a.risks[C.value];if(void 0===e)return void alert("未知ID");t=e.title;break}case"avoidance":{let e=a.avoidances[C.value];if(void 0===e)return void alert("未知ID");t=e.title;break}case"attack-tool":{let e=a.attackTools[C.value];if(void 0===e)return void alert("未知ID");t=e.title;break}case"threat-actor":{let e=a.threatActors[C.value];if(void 0===e)return void alert("未知ID");t=e.title;break}case"ability-provider":{let e=a.abilityProviders[C.value];if(void 0===e)return void alert("未知ID");t=e.title;break}default:return void alert("未知类型")}const e=Object.keys(S).find((t=>S[t]===w.value));M.push({id:C.value,type:S[e],text:C.value+"<br>"+t,color:N[e]})},Z=t=>{a.risks[t].avoidances.forEach((e=>{const l=a.avoidances[e];M.push({id:e,type:"avoidance",text:e+"<br>"+l.title,color:"green"}),U.push({from:t,text:"规避手段",to:e})}))},q=t=>{Object.keys(a.attackTools).filter((e=>a.attackTools[e].risks.includes(t))).forEach((e=>{const l=a.attackTools[e];M.push({id:e,type:"attack-tool",text:e+"<br>"+l.title,color:"blue"}),U.push({from:t,text:"攻击工具",to:e})}))},K=t=>{Object.keys(a.threatActors).filter((e=>a.threatActors[e].makeRisks.includes(t))).forEach((e=>{const l=a.threatActors[e];M.push({id:e,type:"threat-actor",text:e+"<br>"+l.title,color:"red"}),U.push({from:e,text:"造成风险",to:t})}))},W=t=>{Object.keys(a.risks).filter((e=>a.risks[e].avoidances.includes(t))).forEach((e=>{const l=a.risks[e];M.push({id:e,type:"risk",text:e+"<br>"+l.title,color:"orange"}),U.push({from:e,text:"规避手段",to:t})}))},X=t=>{Object.keys(a.abilityProviders).filter((e=>Object.keys(a.abilityProviders[e].abilities).includes(t))).forEach((e=>{const l=a.abilityProviders[e];M.push({id:e,type:"ability-provider",text:e+"<br>"+l.title,color:"purple"}),U.push({from:t,text:"能力提供者",to:e})}))},Y=t=>{a.attackTools[t].risks.forEach((e=>{const l=a.risks[e];M.push({id:e,type:"risk",text:e+"<br>"+l.title,color:"orange"}),U.push({from:t,text:"制造风险",to:e})}))},$=t=>{a.attackTools[t].avoidances.forEach((e=>{const l=a.avoidances[e];M.push({id:e,type:"avoidance",text:e+"<br>"+l.title,color:"green"}),U.push({from:t,text:"规避手段",to:e})}))},G=t=>{Object.keys(a.threatActors).filter((e=>a.threatActors[e].buildAttackTools.includes(t))).forEach((e=>{const l=a.threatActors[e];M.push({id:e,type:"threat-actor",text:e+"<br>"+l.title,color:"red"}),U.push({from:e,text:"制作攻击工具",to:t})}));Object.keys(a.threatActors).filter((e=>a.threatActors[e].useAttackTools.includes(t))).forEach((e=>{const l=a.threatActors[e];M.push({id:e,type:"threat-actor",text:e+"<br>"+l.title,color:"red"}),U.push({from:e,text:"使用攻击工具",to:t})}))},Q=t=>{a.threatActors[t].makeRisks.forEach((e=>{const l=a.risks[e];M.push({id:e,type:"risk",text:e+"<br>"+l.title,color:"orange"}),U.push({from:t,text:"造成风险",to:e})}))},tt=t=>{a.threatActors[t].buildAttackTools.forEach((e=>{const l=a.attackTools[e];M.push({id:e,type:"attack-tool",text:e+"<br>"+l.title,color:"blue"}),U.push({from:t,text:"制作攻击工具",to:e})}));a.threatActors[t].useAttackTools.forEach((e=>{const l=a.attackTools[e];M.push({id:e,type:"attack-tool",text:e+"<br>"+l.title,color:"blue"}),U.push({from:t,text:"使用攻击工具",to:e})}))},et=()=>{var t,e;(()=>{const t=new Set;U.forEach((e=>{t.add(JSON.stringify(e))})),U.splice(0,U.length),t.forEach((t=>{U.push(JSON.parse(t))}))})(),null==(t=null==B?void 0:B.value)||t.setJsonData(z),null==(e=null==B?void 0:B.value)||e.setOptions(J),yt()},at=(t,e,l)=>{var o;"risk"===e?"avoidance"==t?Z(l):"attack-tool"==t?q(l):"threat-actor"==t?K(l):"all"==t&&(Z(l),q(l),(t=>{const e=a.risks[t].avoidances;Object.keys(a.attackTools).filter((e=>a.attackTools[e].risks.includes(t))).forEach((t=>{e.forEach((e=>{a.attackTools[t].avoidances.includes(e)&&U.push({from:e,text:"规避手段",to:t})}))}))})(l),K(l),(t=>{const e=Object.keys(a.threatActors).filter((e=>a.threatActors[e].makeRisks.includes(t))),l=Object.keys(a.attackTools).filter((e=>a.attackTools[e].risks.includes(t)));e.forEach((t=>{l.forEach((e=>{a.threatActors[t].useAttackTools.includes(e)?U.push({from:t,text:"使用攻击工具",to:e}):a.threatActors[t].buildAttackTools.includes(e)&&U.push({from:t,text:"制作攻击工具",to:e})}))}))})(l)):"avoidance"===e?("risk"==t&&W(l),"ability-provider"==t&&X(l),"all"==t&&(W(l),X(l))):"attack-tool"===e?"risk"==t?Y(l):"avoidance"==t?$(l):"threat-actor"==t?G(l):"all"==t&&(Y(l),$(l),(t=>{const e=a.attackTools[t].risks,l=a.attackTools[t].avoidances;e.forEach((t=>{a.risks[t].avoidances.forEach((e=>{l.includes(e)&&U.push({from:t,text:"规避手段",to:e})}))}))})(l),G(l),(t=>{const e=Object.keys(a.threatActors).filter((e=>a.threatActors[e].buildAttackTools.includes(t))),l=Object.keys(a.threatActors).filter((e=>a.threatActors[e].useAttackTools.includes(t))),o=a.attackTools[t].risks;e.forEach((t=>{o.forEach((e=>{a.threatActors[t].makeRisks.includes(e)&&U.push({from:e,text:"攻击工具制造者",to:t})}))})),l.forEach((t=>{o.forEach((e=>{a.threatActors[t].makeRisks.includes(e)&&U.push({from:t,text:"造成风险",to:e})}))}))})(l)):"threat-actor"===e?"risk"==t?Q(l):"attack-tool"==t?tt(l):"all"==t&&(Q(l),tt(l),(t=>{const e=[...a.threatActors[t].buildAttackTools,...a.threatActors[t].useAttackTools],l=a.threatActors[t].makeRisks;e.forEach((t=>{l.forEach((e=>{l.includes(e)&&U.push({from:t,text:"造成风险",to:e})}))}))})(l)):"ability-provider"===e&&("avoidance"!=t&&"all"!=t||(o=l,Object.keys(a.abilityProviders[o].abilities).forEach((t=>{const e=a.avoidances[t];M.push({id:t,type:"avoidance",text:t+"<br>"+e.title,color:"green"}),U.push({from:t,text:"能力提供者",to:o})})))),et()};h((()=>{F(),at("all",w.value,C.value)})),k((()=>[d.params.type,d.params.key]),(t=>{w.value=t[0],C.value=t[1],M.splice(0,M.length),U.splice(0,U.length),F(),at("all",w.value,C.value)}));const lt=v({position:"absolute",zIndex:65535,top:"0px",left:"0px",display:"none"}),ot=n(),st=n(!1),rt=n(!1),it=n(!1),ct=n(!1),ut=n(!1),dt=n(!1),nt=n(!1),vt=n(""),ht=n(""),kt=(t,e)=>{var a;lt.top=e.clientY+"px",lt.left=e.clientX+"px",lt.display="block",null==(a=ot.value)||a.handleOpen(),t.id==C.value?nt.value=!0:nt.value=!1,"risk"===t.type?(st.value=!0,rt.value=!1,it.value=!1,ct.value=!1,ut.value=!0,dt.value=!1):"avoidance"===t.type?(st.value=!1,rt.value=!0,it.value=!0,ct.value=!0,ut.value=!1,dt.value=!1):"attack-tool"===t.type?(st.value=!1,rt.value=!1,it.value=!0,ct.value=!1,ut.value=!0,dt.value=!1):"threat-actor"===t.type?(st.value=!1,rt.value=!0,it.value=!1,ct.value=!0,ut.value=!0,dt.value=!1):"ability-provider"===t.type&&(st.value=!0,rt.value=!1,it.value=!0,ct.value=!0,ut.value=!0,dt.value=!0),vt.value=t.type,ht.value=t.id},pt=t=>{at(t,vt.value,ht.value)},ft=n(["risk","avoidance","attack-tool","threat-actor","ability-provider"]),bt=n([]),yt=()=>{bt.value.splice(0,bt.value.length),U.forEach((t=>{bt.value.includes(t.text)||bt.value.push(t.text)}))},xt=n(bt.value),mt=()=>{var t,e,a;console.log("doFilter",bt,xt);const l=null==(t=B.value)?void 0:t.getInstance().getNodes(),o=null==(e=B.value)?void 0:e.getInstance().getLinks();null==l||l.forEach((t=>{let e=!1;ft.value.includes(t.type)||(e=!0),t.opacity=e?.1:1})),null==o||o.forEach((t=>{t.relations.forEach((t=>{xt.value.includes(t.text)?t.isHide=!1:t.isHide=!0}))})),null==(a=B.value)||a.getInstance().dataUpdated()};return(e,a)=>{const l=r,o=i,d=c,n=u,v=s;return m(),p("div",I,[f(y(t),{ref_key:"graphRef$",ref:B,options:J},{node:b((({node:t})=>[A("div",{style:{cursor:"pointer","font-size":"xx-small",display:"flex",height:"inherit","align-items":"center","justify-content":"center"},onDblclick:e=>kt(t,e),onContextmenu:e=>kt(t,e),innerHTML:t.text},null,40,R)])),"graph-plug":b((()=>[A("div",D,[P,f(o,{modelValue:ft.value,"onUpdate:modelValue":a[0]||(a[0]=t=>ft.value=t),onChange:mt},{default:b((()=>[(m(),E(l,{class:"filter-checkbox",key:"risk",label:"risk"},{default:b((()=>[T("风险")])),_:1},8,["label"])),(m(),E(l,{class:"filter-checkbox",key:"avoidance",label:"avoidance"},{default:b((()=>[T("规避手段")])),_:1},8,["label"])),(m(),E(l,{class:"filter-checkbox",key:"attack-tool",label:"attack-tool"},{default:b((()=>[T("攻击工具")])),_:1},8,["label"])),(m(),E(l,{class:"filter-checkbox",key:"threat-actor",label:"threat-actor"},{default:b((()=>[T("威胁行为者")])),_:1},8,["label"])),(m(),E(l,{class:"filter-checkbox",key:"ability-provider",label:"ability-provider"},{default:b((()=>[T("能力提供者")])),_:1},8,["label"]))])),_:1},8,["modelValue"])]),A("div",V,[H,f(o,{modelValue:xt.value,"onUpdate:modelValue":a[1]||(a[1]=t=>xt.value=t),onChange:mt},{default:b((()=>[(m(!0),p(g,null,_(bt.value,(t=>(m(),E(l,{class:"filter-checkbox",key:t,label:t},{default:b((()=>[T(j(t),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])])),_:1},512),f(v,{ref_key:"dropdown1",ref:ot,handleOpen:!0,style:x(lt)},{dropdown:b((()=>[f(n,null,{default:b((()=>[f(d,{onClick:a[2]||(a[2]=t=>pt("risk")),disabled:st.value},{default:b((()=>[T("风险列表")])),_:1},8,["disabled"]),f(d,{onClick:a[3]||(a[3]=t=>pt("avoidance")),disabled:rt.value},{default:b((()=>[T("规避手段")])),_:1},8,["disabled"]),f(d,{onClick:a[4]||(a[4]=t=>pt("attack-tool")),disabled:it.value},{default:b((()=>[T("攻击工具")])),_:1},8,["disabled"]),f(d,{onClick:a[5]||(a[5]=t=>pt("threat-actor")),disabled:ct.value},{default:b((()=>[T("威胁行为者")])),_:1},8,["disabled"]),f(d,{onClick:a[6]||(a[6]=t=>pt("ability-provider")),disabled:ut.value},{default:b((()=>[T("能力提供者")])),_:1},8,["disabled"]),f(d,{onClick:a[7]||(a[7]=t=>pt("all")),disabled:dt.value},{default:b((()=>[T("全部关系")])),_:1},8,["disabled"]),f(d,{onClick:a[8]||(a[8]=t=>{O.push({name:"relation",params:{type:vt.value,key:ht.value}})}),disabled:nt.value,divided:""},{default:b((()=>[T("作为根节点打开")])),_:1},8,["disabled"])])),_:1})])),default:b((()=>[L])),_:1},8,["style"])])}}}),[["__scopeId","data-v-7a63f592"]]);export{B as default};
