import{b as e,_ as t}from"./index-ZlAdhJC2.js";/* empty css                    */import{B as a}from"./BREAK-P-pQjgaq.js";import{a as l,u as o}from"./vue-router-Nb642-En.js";import{b as s,w as r,x as i,d as c,c as u}from"./element-plus-svN-En_q.js";import{d,b as n,r as v,o as h,w as k,q as p,l as f,W as b,u as y,_ as m,m as x,t as A,V as E,a7 as T,F as _,ah as g,Z as j,ak as O,al as w}from"./vue-n1z6Fgex.js";import"./relation-graph-zKQxcUJx.js";import"./vue-i18n-kmt_8FQk.js";const C=e=>(O("data-v-b9f2e439"),e=e(),w(),e),I={style:{border:"#efefef solid 1px",height:"calc(100vh - 150px)",width:"100%"}},D=["onDblclick","onContextmenu","innerHTML"],P={class:"filter-pane",id:"node-filter-pane"},R=C((()=>A("h2",null,"节点筛选：",-1))),V={class:"filter-pane",id:"line-filter-pane"},L=C((()=>A("h2",null,"关系筛选：",-1))),H=C((()=>A("span",{class:"el-dropdown-link"},null,-1)));var S=(e=>(e.risk="risk",e.avoidance="avoidance",e.attackTool="attack-tool",e.threatActor="threat-actor",e.abilityProvider="ability-provider",e.all="all",e))(S||{}),N=(e=>(e.risk="orange",e.avoidance="green",e.attackTool="blue",e.threatActor="red",e.abilityProvider="purple",e))(N||{});const B=t(d({__name:"RelationView",setup(t){const d=l(),O=o(),w=n(d.params.type),C=n(d.params.key),B=n(),J=v({allowShowMiniToolBar:!0,disableZoom:!1,disableDragCanvas:!1,defaultExpandHolderPosition:"right",defaultShowLineLabel:!0});J.layout={layoutLabel:"中心布局",layoutName:"center",distance_coefficient:2,maxLayoutTimes:20,force_line_elastic:.3,force_node_repulsion:3};const M=v([]),U=v([]),z=v({rootId:C.value,nodes:M,lines:U}),K=()=>{let e;switch(w.value){case"risk":{let t=a.risks[C.value];if(void 0===t)return void alert("未知ID");e=t.title;break}case"avoidance":{let t=a.avoidances[C.value];if(void 0===t)return void alert("未知ID");e=t.title;break}case"attack-tool":{let t=a.attackTools[C.value];if(void 0===t)return void alert("未知ID");e=t.title;break}case"threat-actor":{let t=a.threatActors[C.value];if(void 0===t)return void alert("未知ID");e=t.title;break}case"ability-provider":{let t=a.abilityProviders[C.value];if(void 0===t)return void alert("未知ID");e=t.title;break}default:return void alert("未知类型")}const t=Object.keys(S).find((e=>S[e]===w.value));M.push({id:C.value,type:S[t],text:C.value+"<br>"+e,color:N[t]})},Z=e=>{a.risks[e].avoidances.forEach((t=>{const l=a.avoidances[t];M.push({id:t,type:"avoidance",text:t+"<br>"+l.title,color:"green"}),U.push({from:e,text:"规避手段",to:t})}))},q=e=>{Object.keys(a.attackTools).filter((t=>a.attackTools[t].risks.includes(e))).forEach((t=>{const l=a.attackTools[t];M.push({id:t,type:"attack-tool",text:t+"<br>"+l.title,color:"blue"}),U.push({from:e,text:"攻击工具",to:t})}))},F=e=>{Object.keys(a.threatActors).filter((t=>a.threatActors[t].makeRisks.includes(e))).forEach((t=>{const l=a.threatActors[t];M.push({id:t,type:"threat-actor",text:t+"<br>"+l.title,color:"red"}),U.push({from:t,text:"造成风险",to:e})}))},W=e=>{Object.keys(a.risks).filter((t=>a.risks[t].avoidances.includes(e))).forEach((t=>{const l=a.risks[t];M.push({id:t,type:"risk",text:t+"<br>"+l.title,color:"orange"}),U.push({from:t,text:"规避手段",to:e})}))},X=e=>{Object.keys(a.abilityProviders).filter((t=>Object.keys(a.abilityProviders[t].abilities).includes(e))).forEach((t=>{const l=a.abilityProviders[t];M.push({id:t,type:"ability-provider",text:t+"<br>"+l.title,color:"purple"}),U.push({from:e,text:"能力提供者",to:t})}))},Y=e=>{a.attackTools[e].risks.forEach((t=>{const l=a.risks[t];M.push({id:t,type:"risk",text:t+"<br>"+l.title,color:"orange"}),U.push({from:e,text:"制造风险",to:t})}))},$=e=>{a.attackTools[e].avoidances.forEach((t=>{const l=a.avoidances[t];M.push({id:t,type:"avoidance",text:t+"<br>"+l.title,color:"green"}),U.push({from:e,text:"规避手段",to:t})}))},G=e=>{Object.keys(a.threatActors).filter((t=>a.threatActors[t].buildAttackTools.includes(e))).forEach((t=>{const l=a.threatActors[t];M.push({id:t,type:"threat-actor",text:t+"<br>"+l.title,color:"red"}),U.push({from:t,text:"制作攻击工具",to:e})}));Object.keys(a.threatActors).filter((t=>a.threatActors[t].useAttackTools.includes(e))).forEach((t=>{const l=a.threatActors[t];M.push({id:t,type:"threat-actor",text:t+"<br>"+l.title,color:"red"}),U.push({from:t,text:"使用攻击工具",to:e})}))},Q=e=>{a.threatActors[e].makeRisks.forEach((t=>{const l=a.risks[t];M.push({id:t,type:"risk",text:t+"<br>"+l.title,color:"orange"}),U.push({from:e,text:"造成风险",to:t})}))},ee=e=>{a.threatActors[e].buildAttackTools.forEach((t=>{const l=a.attackTools[t];M.push({id:t,type:"attack-tool",text:t+"<br>"+l.title,color:"blue"}),U.push({from:e,text:"制作攻击工具",to:t})}));a.threatActors[e].useAttackTools.forEach((t=>{const l=a.attackTools[t];M.push({id:t,type:"attack-tool",text:t+"<br>"+l.title,color:"blue"}),U.push({from:e,text:"使用攻击工具",to:t})}))},te=()=>{var e;(()=>{const e=new Set;U.forEach((t=>{e.add(JSON.stringify(t))})),U.splice(0,U.length),e.forEach((e=>{U.push(JSON.parse(e))}))})(),null==(e=null==B?void 0:B.value)||e.setJsonData(z),ye()},ae=(e,t,l)=>{var o;"risk"===t?"avoidance"==e?Z(l):"attack-tool"==e?q(l):"threat-actor"==e?F(l):"all"==e&&(Z(l),q(l),(e=>{const t=a.risks[e].avoidances;Object.keys(a.attackTools).filter((t=>a.attackTools[t].risks.includes(e))).forEach((e=>{t.forEach((t=>{a.attackTools[e].avoidances.includes(t)&&U.push({from:t,text:"规避手段",to:e})}))}))})(l),F(l),(e=>{const t=Object.keys(a.threatActors).filter((t=>a.threatActors[t].makeRisks.includes(e))),l=Object.keys(a.attackTools).filter((t=>a.attackTools[t].risks.includes(e)));t.forEach((e=>{l.forEach((t=>{a.threatActors[e].useAttackTools.includes(t)?U.push({from:e,text:"使用攻击工具",to:t}):a.threatActors[e].buildAttackTools.includes(t)&&U.push({from:e,text:"制作攻击工具",to:t})}))}))})(l)):"avoidance"===t?("risk"==e&&W(l),"ability-provider"==e&&X(l),"all"==e&&(W(l),X(l))):"attack-tool"===t?"risk"==e?Y(l):"avoidance"==e?$(l):"threat-actor"==e?G(l):"all"==e&&(Y(l),$(l),(e=>{const t=a.attackTools[e].risks,l=a.attackTools[e].avoidances;t.forEach((e=>{a.risks[e].avoidances.forEach((t=>{l.includes(t)&&U.push({from:e,text:"规避手段",to:t})}))}))})(l),G(l),(e=>{const t=Object.keys(a.threatActors).filter((t=>a.threatActors[t].buildAttackTools.includes(e))),l=Object.keys(a.threatActors).filter((t=>a.threatActors[t].useAttackTools.includes(e))),o=a.attackTools[e].risks;t.forEach((e=>{o.forEach((t=>{a.threatActors[e].makeRisks.includes(t)&&U.push({from:t,text:"攻击工具制造者",to:e})}))})),l.forEach((e=>{o.forEach((t=>{a.threatActors[e].makeRisks.includes(t)&&U.push({from:e,text:"造成风险",to:t})}))}))})(l)):"threat-actor"===t?"risk"==e?Q(l):"attack-tool"==e?ee(l):"all"==e&&(Q(l),ee(l),(e=>{const t=[...a.threatActors[e].buildAttackTools,...a.threatActors[e].useAttackTools],l=a.threatActors[e].makeRisks;t.forEach((e=>{l.forEach((t=>{l.includes(t)&&U.push({from:e,text:"造成风险",to:t})}))}))})(l)):"ability-provider"===t&&("avoidance"!=e&&"all"!=e||(o=l,Object.keys(a.abilityProviders[o].abilities).forEach((e=>{const t=a.avoidances[e];M.push({id:e,type:"avoidance",text:e+"<br>"+t.title,color:"green"}),U.push({from:e,text:"能力提供者",to:o})})))),te()};h((()=>{K(),ae("all",w.value,C.value)})),k((()=>[d.params.type,d.params.key]),(e=>{w.value=e[0],C.value=e[1],M.splice(0,M.length),U.splice(0,U.length),K(),ae("all",w.value,C.value)}));const le=v({position:"absolute",zIndex:65535,top:"0px",left:"0px",display:"none"}),oe=n(),se=n(!1),re=n(!1),ie=n(!1),ce=n(!1),ue=n(!1),de=n(!1),ne=n(!1),ve=n(""),he=n(""),ke=(e,t)=>{var a;switch(le.top=t.clientY+"px",le.left=t.clientX+"px",le.display="block",null==(a=oe.value)||a.handleOpen(),e.type){case"risk":se.value=!0,re.value=!1,ie.value=!1,ce.value=!1,ue.value=!0,de.value=!1,ne.value=!1;break;case"avoidance":se.value=!1,re.value=!0,ie.value=!0,ce.value=!0,ue.value=!1,de.value=!1,ne.value=!1;break;case"attack-tool":se.value=!1,re.value=!1,ie.value=!0,ce.value=!1,ue.value=!0,de.value=!1,ne.value=!1;break;case"threat-actor":se.value=!1,re.value=!0,ie.value=!1,ce.value=!0,ue.value=!0,de.value=!1,ne.value=!1;break;case"ability-provider":se.value=!0,re.value=!1,ie.value=!0,ce.value=!0,ue.value=!0,de.value=!0,ne.value=!1}e.id==C.value&&(ne.value=!0),ve.value=e.type,he.value=e.id},pe=e=>{ae(e,ve.value,he.value)},fe=n(["risk","avoidance","attack-tool","threat-actor","ability-provider"]),be=n([]),ye=()=>{be.value.splice(0,be.value.length),U.forEach((e=>{be.value.includes(e.text)||be.value.push(e.text)}))},me=n(be.value),xe=()=>{var e,t,a;const l=null==(e=B.value)?void 0:e.getInstance().getNodes(),o=null==(t=B.value)?void 0:t.getInstance().getLinks();null==l||l.forEach((e=>{let t=!1;fe.value.includes(e.type)||(t=!0),e.opacity=t?.1:1})),null==o||o.forEach((e=>{e.relations.forEach((e=>{me.value.includes(e.text)?e.isHide=!1:e.isHide=!0}))})),null==(a=B.value)||a.getInstance().dataUpdated()};return(t,a)=>{const l=r,o=i,d=c,n=u,v=s;return x(),p("div",I,[f(y(e),{ref_key:"graphRef$",ref:B,options:J},{node:b((({node:e})=>[A("div",{style:{cursor:"pointer","font-size":"xx-small",display:"flex",height:"inherit","align-items":"center","justify-content":"center"},onDblclick:t=>ke(e,t),onContextmenu:t=>ke(e,t),innerHTML:e.text},null,40,D)])),"graph-plug":b((()=>[A("div",P,[R,f(o,{modelValue:fe.value,"onUpdate:modelValue":a[0]||(a[0]=e=>fe.value=e),onChange:xe},{default:b((()=>[(x(),E(l,{class:"filter-checkbox",key:"risk",label:"risk",name:"risk"},{default:b((()=>[T("风险")])),_:1},8,["label","name"])),(x(),E(l,{class:"filter-checkbox",key:"avoidance",label:"avoidance",name:"avoidance"},{default:b((()=>[T("规避手段")])),_:1},8,["label","name"])),(x(),E(l,{class:"filter-checkbox",key:"attack-tool",label:"attack-tool",name:"attack-tool"},{default:b((()=>[T("攻击工具")])),_:1},8,["label","name"])),(x(),E(l,{class:"filter-checkbox",key:"threat-actor",label:"threat-actor",name:"threat-actor"},{default:b((()=>[T("威胁行为者")])),_:1},8,["label","name"])),(x(),E(l,{class:"filter-checkbox",key:"ability-provider",label:"ability-provider",name:"ability-provider"},{default:b((()=>[T("能力提供者")])),_:1},8,["label","name"]))])),_:1},8,["modelValue"])]),A("div",V,[L,f(o,{modelValue:me.value,"onUpdate:modelValue":a[1]||(a[1]=e=>me.value=e),onChange:xe},{default:b((()=>[(x(!0),p(_,null,g(be.value,(e=>(x(),E(l,{class:"filter-checkbox",key:e,label:e,name:e},{default:b((()=>[T(j(e),1)])),_:2},1032,["label","name"])))),128))])),_:1},8,["modelValue"])])])),_:1},8,["options"]),f(v,{ref_key:"dropdown1",ref:oe,handleOpen:!0,style:m(le)},{dropdown:b((()=>[f(n,null,{default:b((()=>[f(d,{onClick:a[2]||(a[2]=e=>(()=>{let e="";switch(ve.value){case"risk":return e="riskDetail",void O.push({name:e,params:{rKey:he.value}});case"avoidance":e="avoidances";break;case"attack-tool":e="attackTools";break;case"threat-actor":e="threatActors";break;case"ability-provider":e="abilityProviders"}O.push({name:e,hash:"#"+he.value})})())},{default:b((()=>[T("查看详情")])),_:1}),f(d,{onClick:a[3]||(a[3]=e=>pe("risk")),divided:"",disabled:se.value},{default:b((()=>[T("风险列表")])),_:1},8,["disabled"]),f(d,{onClick:a[4]||(a[4]=e=>pe("avoidance")),disabled:re.value},{default:b((()=>[T("规避手段")])),_:1},8,["disabled"]),f(d,{onClick:a[5]||(a[5]=e=>pe("attack-tool")),disabled:ie.value},{default:b((()=>[T("攻击工具")])),_:1},8,["disabled"]),f(d,{onClick:a[6]||(a[6]=e=>pe("threat-actor")),disabled:ce.value},{default:b((()=>[T("威胁行为者")])),_:1},8,["disabled"]),f(d,{onClick:a[7]||(a[7]=e=>pe("ability-provider")),disabled:ue.value},{default:b((()=>[T("能力提供者")])),_:1},8,["disabled"]),f(d,{onClick:a[8]||(a[8]=e=>pe("all")),disabled:de.value},{default:b((()=>[T("拉取全部关系")])),_:1},8,["disabled"]),f(d,{onClick:a[9]||(a[9]=e=>{O.push({name:"relation",params:{type:ve.value,key:he.value}})}),disabled:ne.value,divided:""},{default:b((()=>[T("作为根节点打开")])),_:1},8,["disabled"])])),_:1})])),default:b((()=>[H])),_:1},8,["style"])])}}}),[["__scopeId","data-v-b9f2e439"]]);export{B as default};
