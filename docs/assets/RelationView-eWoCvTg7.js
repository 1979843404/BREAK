import{b as t}from"./index-iMnyBtRK.js";/* empty css                    */import{B as e}from"./BREAK-Z94lMw7a.js";import{a,u as l}from"./vue-router-Nb642-En.js";import{b as o,v as s,w as r,d as i,c}from"./element-plus-ibTVCnbi.js";import{d as u,b as d,r as n,o as v,w as h,q as k,l as p,W as f,u as b,_ as y,m as x,t as m,V as A,a7 as E,F as T,ah as g,Z as _}from"./vue-n1z6Fgex.js";import"./vue-i18n-kmt_8FQk.js";const j={style:{border:"#efefef solid 1px",height:"calc(100vh - 150px)",width:"100%"}},O=["onDblclick","onContextmenu","innerHTML"],w={class:"filter-pane",id:"node-filter-pane"},C=m("h2",null,"节点筛选：",-1),I={class:"filter-pane",id:"line-filter-pane"},R=m("h2",null,"关系筛选：",-1),D=m("span",{class:"el-dropdown-link"},null,-1);var P=(t=>(t.risk="risk",t.avoidance="avoidance",t.attackTool="attack-tool",t.threatActor="threat-actor",t.abilityProvider="ability-provider",t.all="all",t.openAsRoot="open-as-root",t))(P||{}),V=(t=>(t.risk="orange",t.avoidance="green",t.attackTool="blue",t.threatActor="red",t.abilityProvider="purple",t))(V||{});const H=u({__name:"RelationView",setup(u){const H=a(),L=l(),S=d(H.params.type),N=d(H.params.key),B=d(),J={allowShowMiniToolBar:!0,disableZoom:!1,disableDragCanvas:!1,defaultExpandHolderPosition:"right",defaultShowLineLabel:!0,layout:{layoutName:"center",distance_coefficient:2}},M=n([]),U=n([]),z=n({rootId:N.value,nodes:M,lines:U}),F=()=>{let t;switch(S.value){case"risk":{let a=e.risks[N.value];if(void 0===a)return void alert("未知ID");t=a.title;break}case"avoidance":{let a=e.avoidances[N.value];if(void 0===a)return void alert("未知ID");t=a.title;break}case"attack-tool":{let a=e.attackTools[N.value];if(void 0===a)return void alert("未知ID");t=a.title;break}case"threat-actor":{let a=e.threatActors[N.value];if(void 0===a)return void alert("未知ID");t=a.title;break}case"ability-provider":{let a=e.abilityProviders[N.value];if(void 0===a)return void alert("未知ID");t=a.title;break}default:return void alert("未知类型")}const a=Object.keys(P).find((t=>P[t]===S.value));M.push({id:N.value,type:P[a],text:N.value+"<br>"+t,color:V[a]})},Z=t=>{e.risks[t].avoidances.forEach((a=>{const l=e.avoidances[a];M.push({id:a,type:"avoidance",text:a+"<br>"+l.title,color:"green"}),U.push({from:t,text:"规避手段",to:a})}))},q=t=>{Object.keys(e.attackTools).filter((a=>e.attackTools[a].risks.includes(t))).forEach((a=>{const l=e.attackTools[a];M.push({id:a,type:"attack-tool",text:a+"<br>"+l.title,color:"blue"}),U.push({from:t,text:"攻击工具",to:a})}))},K=t=>{Object.keys(e.threatActors).filter((a=>e.threatActors[a].makeRisks.includes(t))).forEach((a=>{const l=e.threatActors[a];M.push({id:a,type:"threat-actor",text:a+"<br>"+l.title,color:"red"}),U.push({from:a,text:"造成风险",to:t})}))},W=t=>{Object.keys(e.risks).filter((a=>e.risks[a].avoidances.includes(t))).forEach((a=>{const l=e.risks[a];M.push({id:a,type:"risk",text:a+"<br>"+l.title,color:"orange"}),U.push({from:a,text:"规避手段",to:t})}))},X=t=>{Object.keys(e.abilityProviders).filter((a=>Object.keys(e.abilityProviders[a].abilities).includes(t))).forEach((a=>{const l=e.abilityProviders[a];M.push({id:a,type:"ability-provider",text:a+"<br>"+l.title,color:"purple"}),U.push({from:t,text:"能力提供者",to:a})}))},Y=t=>{e.attackTools[t].risks.forEach((a=>{const l=e.risks[a];M.push({id:a,type:"risk",text:a+"<br>"+l.title,color:"orange"}),U.push({from:t,text:"制造风险",to:a})}))},$=t=>{e.attackTools[t].avoidances.forEach((a=>{const l=e.avoidances[a];M.push({id:a,type:"avoidance",text:a+"<br>"+l.title,color:"green"}),U.push({from:t,text:"规避手段",to:a})}))},G=t=>{Object.keys(e.threatActors).filter((a=>e.threatActors[a].buildAttackTools.includes(t))).forEach((a=>{const l=e.threatActors[a];M.push({id:a,type:"threat-actor",text:a+"<br>"+l.title,color:"red"}),U.push({from:a,text:"制作攻击工具",to:t})}));Object.keys(e.threatActors).filter((a=>e.threatActors[a].useAttackTools.includes(t))).forEach((a=>{const l=e.threatActors[a];M.push({id:a,type:"threat-actor",text:a+"<br>"+l.title,color:"red"}),U.push({from:a,text:"使用攻击工具",to:t})}))},Q=t=>{e.threatActors[t].makeRisks.forEach((a=>{const l=e.risks[a];M.push({id:a,type:"risk",text:a+"<br>"+l.title,color:"orange"}),U.push({from:t,text:"造成风险",to:a})}))},tt=t=>{e.threatActors[t].buildAttackTools.forEach((a=>{const l=e.attackTools[a];M.push({id:a,type:"attack-tool",text:a+"<br>"+l.title,color:"blue"}),U.push({from:t,text:"制作攻击工具",to:a})}));e.threatActors[t].useAttackTools.forEach((a=>{const l=e.attackTools[a];M.push({id:a,type:"attack-tool",text:a+"<br>"+l.title,color:"blue"}),U.push({from:t,text:"使用攻击工具",to:a})}))},et=()=>{var t,e;(()=>{const t=new Set;U.forEach((e=>{t.add(JSON.stringify(e))})),U.splice(0,U.length),t.forEach((t=>{U.push(JSON.parse(t))}))})(),null==(t=null==B?void 0:B.value)||t.setJsonData(z),null==(e=null==B?void 0:B.value)||e.setOptions(J),yt()},at=(t,a,l)=>{var o;"risk"===a?"avoidance"==t?Z(l):"attack-tool"==t?q(l):"threat-actor"==t?K(l):"all"==t&&(Z(l),q(l),(t=>{const a=e.risks[t].avoidances;Object.keys(e.attackTools).filter((a=>e.attackTools[a].risks.includes(t))).forEach((t=>{a.forEach((a=>{e.attackTools[t].avoidances.includes(a)&&U.push({from:a,text:"规避手段",to:t})}))}))})(l),K(l),(t=>{const a=Object.keys(e.threatActors).filter((a=>e.threatActors[a].makeRisks.includes(t))),l=Object.keys(e.attackTools).filter((a=>e.attackTools[a].risks.includes(t)));a.forEach((t=>{l.forEach((a=>{e.threatActors[t].useAttackTools.includes(a)?U.push({from:t,text:"使用攻击工具",to:a}):e.threatActors[t].buildAttackTools.includes(a)&&U.push({from:t,text:"制作攻击工具",to:a})}))}))})(l)):"avoidance"===a?("risk"==t&&W(l),"ability-provider"==t&&X(l),"all"==t&&(W(l),X(l))):"attack-tool"===a?"risk"==t?Y(l):"avoidance"==t?$(l):"threat-actor"==t?G(l):"all"==t&&(Y(l),$(l),(t=>{const a=e.attackTools[t].risks,l=e.attackTools[t].avoidances;a.forEach((t=>{e.risks[t].avoidances.forEach((e=>{l.includes(e)&&U.push({from:t,text:"规避手段",to:e})}))}))})(l),G(l),(t=>{const a=Object.keys(e.threatActors).filter((a=>e.threatActors[a].buildAttackTools.includes(t))),l=Object.keys(e.threatActors).filter((a=>e.threatActors[a].useAttackTools.includes(t))),o=e.attackTools[t].risks;a.forEach((t=>{o.forEach((a=>{e.threatActors[t].makeRisks.includes(a)&&U.push({from:a,text:"攻击工具制造者",to:t})}))})),l.forEach((t=>{o.forEach((a=>{e.threatActors[t].makeRisks.includes(a)&&U.push({from:t,text:"造成风险",to:a})}))}))})(l)):"threat-actor"===a?"risk"==t?Q(l):"attack-tool"==t?tt(l):"all"==t&&(Q(l),tt(l),(t=>{const a=[...e.threatActors[t].buildAttackTools,...e.threatActors[t].useAttackTools],l=e.threatActors[t].makeRisks;a.forEach((t=>{l.forEach((e=>{l.includes(e)&&U.push({from:t,text:"造成风险",to:e})}))}))})(l)):"ability-provider"===a&&("avoidance"!=t&&"all"!=t||(o=l,Object.keys(e.abilityProviders[o].abilities).forEach((t=>{const a=e.avoidances[t];M.push({id:t,type:"avoidance",text:t+"<br>"+a.title,color:"green"}),U.push({from:t,text:"能力提供者",to:o})})))),et()};v((()=>{F(),at("all",S.value,N.value)})),h((()=>[H.params.type,H.params.key]),(t=>{S.value=t[0],N.value=t[1],M.splice(0,M.length),U.splice(0,U.length),F(),at("all",S.value,N.value)}));const lt=n({position:"absolute",zIndex:65535,top:"0px",left:"0px",display:"none"}),ot=d(),st=d(!1),rt=d(!1),it=d(!1),ct=d(!1),ut=d(!1),dt=d(!1),nt=d(!1),vt=d(""),ht=d(""),kt=(t,e)=>{var a;lt.top=e.clientY+"px",lt.left=e.clientX+"px",lt.display="block",null==(a=ot.value)||a.handleOpen(),t.id==N.value?nt.value=!0:nt.value=!1,"risk"===t.type?(st.value=!0,rt.value=!1,it.value=!1,ct.value=!1,ut.value=!0,dt.value=!1):"avoidance"===t.type?(st.value=!1,rt.value=!0,it.value=!0,ct.value=!0,ut.value=!1,dt.value=!1):"attack-tool"===t.type?(st.value=!1,rt.value=!1,it.value=!0,ct.value=!1,ut.value=!0,dt.value=!1):"threat-actor"===t.type?(st.value=!1,rt.value=!0,it.value=!1,ct.value=!0,ut.value=!0,dt.value=!1):"ability-provider"===t.type&&(st.value=!0,rt.value=!1,it.value=!0,ct.value=!0,ut.value=!0,dt.value=!0),vt.value=t.type,ht.value=t.id},pt=t=>{at(t,vt.value,ht.value)},ft=d(["risk","avoidance","attack-tool","threat-actor","ability-provider"]),bt=d([]),yt=()=>{bt.value.splice(0,bt.value.length),U.forEach((t=>{bt.value.includes(t.text)||bt.value.push(t.text)}))},xt=d(bt.value),mt=()=>{var t,e,a;console.log("doFilter",bt,xt);const l=null==(t=B.value)?void 0:t.getInstance().getNodes(),o=null==(e=B.value)?void 0:e.getInstance().getLinks();null==l||l.forEach((t=>{let e=!1;ft.value.includes(t.type)||(e=!0),t.opacity=e?.1:1})),null==o||o.forEach((t=>{t.relations.forEach((t=>{xt.value.includes(t.text)?t.isHide=!1:t.isHide=!0}))})),null==(a=B.value)||a.getInstance().dataUpdated()};return(e,a)=>{const l=s,u=r,d=i,n=c,v=o;return x(),k("div",j,[p(b(t),{ref_key:"graphRef$",ref:B,options:J},{node:f((({node:t})=>[m("div",{style:{cursor:"pointer","font-size":"xx-small",display:"flex",height:"inherit","align-items":"center","justify-content":"center"},onDblclick:e=>kt(t,e),onContextmenu:e=>kt(t,e),innerHTML:t.text},null,40,O)])),"graph-plug":f((()=>[m("div",w,[C,p(u,{modelValue:ft.value,"onUpdate:modelValue":a[0]||(a[0]=t=>ft.value=t),onChange:mt},{default:f((()=>[(x(),A(l,{class:"filter-checkbox",key:"risk",label:"risk"},{default:f((()=>[E("风险")])),_:1},8,["label"])),(x(),A(l,{class:"filter-checkbox",key:"avoidance",label:"avoidance"},{default:f((()=>[E("规避手段")])),_:1},8,["label"])),(x(),A(l,{class:"filter-checkbox",key:"attack-tool",label:"attack-tool"},{default:f((()=>[E("攻击工具")])),_:1},8,["label"])),(x(),A(l,{class:"filter-checkbox",key:"threat-actor",label:"threat-actor"},{default:f((()=>[E("威胁行为者")])),_:1},8,["label"])),(x(),A(l,{class:"filter-checkbox",key:"ability-provider",label:"ability-provider"},{default:f((()=>[E("能力提供者")])),_:1},8,["label"]))])),_:1},8,["modelValue"])]),m("div",I,[R,p(u,{modelValue:xt.value,"onUpdate:modelValue":a[1]||(a[1]=t=>xt.value=t),onChange:mt},{default:f((()=>[(x(!0),k(T,null,g(bt.value,(t=>(x(),A(l,{class:"filter-checkbox",key:t,label:t},{default:f((()=>[E(_(t),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])])),_:1},512),p(v,{ref_key:"dropdown1",ref:ot,handleOpen:!0,style:y(lt)},{dropdown:f((()=>[p(n,null,{default:f((()=>[p(d,{onClick:a[2]||(a[2]=t=>pt("risk")),disabled:st.value},{default:f((()=>[E("风险列表")])),_:1},8,["disabled"]),p(d,{onClick:a[3]||(a[3]=t=>pt("avoidance")),disabled:rt.value},{default:f((()=>[E("规避手段")])),_:1},8,["disabled"]),p(d,{onClick:a[4]||(a[4]=t=>pt("attack-tool")),disabled:it.value},{default:f((()=>[E("攻击工具")])),_:1},8,["disabled"]),p(d,{onClick:a[5]||(a[5]=t=>pt("threat-actor")),disabled:ct.value},{default:f((()=>[E("威胁行为者")])),_:1},8,["disabled"]),p(d,{onClick:a[6]||(a[6]=t=>pt("ability-provider")),disabled:ut.value},{default:f((()=>[E("能力提供者")])),_:1},8,["disabled"]),p(d,{onClick:a[7]||(a[7]=t=>pt("all")),disabled:dt.value},{default:f((()=>[E("全部关系")])),_:1},8,["disabled"]),p(d,{onClick:a[8]||(a[8]=t=>{L.push({name:"relation",params:{type:vt.value,key:ht.value}})}),disabled:nt.value,divided:""},{default:f((()=>[E("作为根节点打开")])),_:1},8,["disabled"])])),_:1})])),default:f((()=>[D])),_:1},8,["style"])])}}});export{H as default};
