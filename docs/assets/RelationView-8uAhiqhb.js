import{b as e,_ as t}from"./index-WOscltcs.js";/* empty css                    */import{B as a}from"./BREAK-yZfrb2uf.js";import{a as o,u as l}from"./vue-router-mKocEu41.js";import{b as s,s as r,t as i,z as c,A as n,d as u,c as d}from"./element-plus-DxuawtAF.js";import{d as v,b as p,r as h,o as k,w as b,q as f,l as y,W as x,u as m,_ as A,m as C,t as T,F as E,ai as M,V as j,a7 as _,Z as g,al as O,am as w}from"./vue-rmd1cPzt.js";import"./relation-graph-aM9PJqhq.js";import"./vue-i18n-UgkcYfIM.js";import"./BREAK-Risks-sL91HopF.js";import"./BREAK-Avoidances-UUqw6tA9.js";const V=e=>(O("data-v-701a889d"),e=e(),w(),e),B={style:{border:"#efefef solid 1px",height:"calc(100vh - 150px)",width:"100%"}},R=["onDblclick","onContextmenu","innerHTML"],K={class:"filter-pane",id:"node-filter-pane"},I=V((()=>T("h2",null,"节点筛选：",-1))),P={class:"filter-pane",id:"line-filter-pane"},D=V((()=>T("h2",null,"关系筛选：",-1))),L=V((()=>T("span",{class:"el-dropdown-link"},null,-1)));var H=(e=>(e.risk="risk",e.avoidance="avoidance",e.attackTool="attack-tool",e.threatActor="threat-actor",e.abilityProvider="ability-provider",e.all="all",e))(H||{});const S=t(v({__name:"RelationView",setup(t){const v=o(),O=l(),w={risk:{title:"风险",relType:"risk",BreakKey:"risks",color:"orange",disableContextMenu:p(!1)},avoidance:{title:"规避手段",relType:"avoidance",BreakKey:"avoidances",color:"green",disableContextMenu:p(!1)},"attack-tool":{title:"攻击工具",relType:"attack-tool",BreakKey:"attackTools",color:"blue",disableContextMenu:p(!1)},"threat-actor":{title:"威胁行为者",relType:"threat-actor",BreakKey:"threatActors",color:"red",disableContextMenu:p(!1)},"ability-provider":{title:"能力提供者",relType:"ability-provider",BreakKey:"abilityProviders",color:"purple",disableContextMenu:p(!1)}},V=p(v.params.type),S=p(v.params.key),U=p(),N=h({allowShowMiniToolBar:!0,disableZoom:!1,disableDragCanvas:!1,defaultExpandHolderPosition:"right",defaultShowLineLabel:!0});N.layout={layoutLabel:"中心布局",layoutName:"center",distance_coefficient:2,maxLayoutTimes:20,force_line_elastic:.3,force_node_repulsion:3};const z=h([]),J=h([]),Z=h({rootId:S.value,nodes:z,lines:J}),q=()=>{const e=w[V.value],t=a[e.BreakKey][S.value];void 0!==t?z.push({id:S.value,type:e.relType,text:S.value+"<br>"+t.title,color:e.color}):alert("未知ID")},F=e=>{a.risks[e].avoidances.forEach((t=>{const o=a.avoidances[t];z.push({id:t,type:"avoidance",text:t+"<br>"+o.title,color:w.avoidance.color}),J.push({from:e,text:"规避手段",to:t})}))},W=e=>{Object.keys(a.attackTools).filter((t=>a.attackTools[t].risks.includes(e))).forEach((t=>{const o=a.attackTools[t];z.push({id:t,type:"attack-tool",text:t+"<br>"+o.title,color:w["attack-tool"].color}),J.push({from:e,text:"攻击工具",to:t})}))},X=e=>{Object.keys(a.threatActors).filter((t=>a.threatActors[t].makeRisks.includes(e))).forEach((t=>{const o=a.threatActors[t];z.push({id:t,type:"threat-actor",text:t+"<br>"+o.title,color:w["threat-actor"].color}),J.push({from:t,text:"造成风险",to:e})}))},Y=e=>{Object.keys(a.risks).filter((t=>a.risks[t].avoidances.includes(e))).forEach((t=>{const o=a.risks[t];z.push({id:t,type:"risk",text:t+"<br>"+o.title,color:w.risk.color}),J.push({from:t,text:"规避手段",to:e})}))},$=e=>{Object.keys(a.abilityProviders).filter((t=>Object.keys(a.abilityProviders[t].abilities).includes(e))).forEach((t=>{const o=a.abilityProviders[t];z.push({id:t,type:"ability-provider",text:t+"<br>"+o.title,color:w["ability-provider"].color}),J.push({from:e,text:"能力提供者",to:t})}))},G=e=>{a.attackTools[e].risks.forEach((t=>{const o=a.risks[t];z.push({id:t,type:"risk",text:t+"<br>"+o.title,color:w.risk.color}),J.push({from:e,text:"制造风险",to:t})}))},Q=e=>{a.attackTools[e].avoidances.forEach((t=>{const o=a.avoidances[t];z.push({id:t,type:"avoidance",text:t+"<br>"+o.title,color:w.avoidance.color}),J.push({from:e,text:"规避手段",to:t})}))},ee=e=>{Object.keys(a.threatActors).filter((t=>a.threatActors[t].buildAttackTools.includes(e))).forEach((t=>{const o=a.threatActors[t];z.push({id:t,type:"threat-actor",text:t+"<br>"+o.title,color:w["threat-actor"].color}),J.push({from:t,text:"制作攻击工具",to:e})}));Object.keys(a.threatActors).filter((t=>a.threatActors[t].useAttackTools.includes(e))).forEach((t=>{const o=a.threatActors[t];z.push({id:t,type:"threat-actor",text:t+"<br>"+o.title,color:w["threat-actor"].color}),J.push({from:t,text:"使用攻击工具",to:e})}))},te=e=>{a.threatActors[e].makeRisks.forEach((t=>{const o=a.risks[t];z.push({id:t,type:"risk",text:t+"<br>"+o.title,color:w.risk.color}),J.push({from:e,text:"造成风险",to:t})}))},ae=e=>{a.threatActors[e].buildAttackTools.forEach((t=>{const o=a.attackTools[t];z.push({id:t,type:"attack-tool",text:t+"<br>"+o.title,color:w["attack-tool"].color}),J.push({from:e,text:"制作攻击工具",to:t})}));a.threatActors[e].useAttackTools.forEach((t=>{const o=a.attackTools[t];z.push({id:t,type:"attack-tool",text:t+"<br>"+o.title,color:w["attack-tool"].color}),J.push({from:e,text:"使用攻击工具",to:t})}))},oe=()=>{var e;(()=>{const e=new Set;J.forEach((t=>{e.add(JSON.stringify(t))})),J.splice(0,J.length),e.forEach((e=>{J.push(JSON.parse(e))}))})(),null==(e=null==U?void 0:U.value)||e.setJsonData(Z),ke()},le=(e,t,o)=>{var l,s,r,i,c;"risk"===t?"avoidance"==e?F(o):"attack-tool"==e?W(o):"threat-actor"==e?X(o):"all"==e&&(F(o),W(o),(e=>{const t=a.risks[e].avoidances;Object.keys(a.attackTools).filter((t=>a.attackTools[t].risks.includes(e))).forEach((e=>{t.forEach((t=>{a.attackTools[e].avoidances.includes(t)&&J.push({from:t,text:"规避手段",to:e})}))}))})(o),X(o),(e=>{const t=Object.keys(a.threatActors).filter((t=>a.threatActors[t].makeRisks.includes(e))),o=Object.keys(a.attackTools).filter((t=>a.attackTools[t].risks.includes(e)));t.forEach((e=>{o.forEach((t=>{a.threatActors[e].useAttackTools.includes(t)?J.push({from:e,text:"使用攻击工具",to:t}):a.threatActors[e].buildAttackTools.includes(t)&&J.push({from:e,text:"制作攻击工具",to:t})}))}))})(o),c=o,Object.keys(a.risks).filter((e=>e.includes(c)&&e!=c)).forEach((e=>{z.push({id:e,type:"risk",text:e+"<br>"+a.risks[e].title,color:w.risk.color}),J.push({from:c,text:"子风险",to:e})}))):"avoidance"===t?("risk"==e&&Y(o),"ability-provider"==e&&$(o),"all"==e&&(Y(o),$(o),i=o,Object.keys(a.avoidances).filter((e=>e.includes(i)&&e!=i)).forEach((e=>{z.push({id:e,type:"avoidance",text:e+"<br>"+a.avoidances[e].title,color:w.avoidance.color}),J.push({from:i,text:"子规避手段",to:e})})))):"attack-tool"===t?"risk"==e?G(o):"avoidance"==e?Q(o):"threat-actor"==e?ee(o):"all"==e&&(G(o),Q(o),(e=>{const t=a.attackTools[e].risks,o=a.attackTools[e].avoidances;t.forEach((e=>{a.risks[e].avoidances.forEach((t=>{o.includes(t)&&J.push({from:e,text:"规避手段",to:t})}))}))})(o),ee(o),(e=>{const t=Object.keys(a.threatActors).filter((t=>a.threatActors[t].buildAttackTools.includes(e))),o=Object.keys(a.threatActors).filter((t=>a.threatActors[t].useAttackTools.includes(e))),l=a.attackTools[e].risks;t.forEach((e=>{l.forEach((t=>{a.threatActors[e].makeRisks.includes(t)&&J.push({from:t,text:"攻击工具制造者",to:e})}))})),o.forEach((e=>{l.forEach((t=>{a.threatActors[e].makeRisks.includes(t)&&J.push({from:e,text:"造成风险",to:t})}))}))})(o),r=o,Object.keys(a.attackTools).filter((e=>e.includes(r)&&e!=r)).forEach((e=>{z.push({id:e,type:"attack-tool",text:e+"<br>"+a.attackTools[e].title,color:w["attack-tool"].color}),J.push({from:r,text:"子攻击工具",to:e})}))):"threat-actor"===t?"risk"==e?te(o):"attack-tool"==e?ae(o):"all"==e&&(te(o),ae(o),(e=>{const t=[...a.threatActors[e].buildAttackTools,...a.threatActors[e].useAttackTools],o=a.threatActors[e].makeRisks;t.forEach((e=>{o.forEach((t=>{o.includes(t)&&J.push({from:e,text:"造成风险",to:t})}))}))})(o),s=o,Object.keys(a.threatActors).filter((e=>e.includes(s)&&e!=s)).forEach((e=>{z.push({id:e,type:"threat-actor",text:e+"<br>"+a.threatActors[e].title,color:w["threat-actor"].color}),J.push({from:s,text:"子威胁行为者",to:e})}))):"ability-provider"===t&&("avoidance"!=e&&"all"!=e||(l=o,Object.keys(a.abilityProviders[l].abilities).forEach((e=>{const t=a.avoidances[e];z.push({id:e,type:"avoidance",text:e+"<br>"+t.title,color:w.avoidance.color}),J.push({from:e,text:"能力提供者",to:l})})))),oe()};k((()=>{if(!Object.values(H).includes(v.params.type)||!Object.keys(a[w[v.params.type].BreakKey]).includes(v.params.key))return alert("未知类型或ID"),void O.push({name:"relation",params:{type:"risk",key:"R0001"}}).then((()=>{location.reload()}));q(),le("all",V.value,S.value)})),b((()=>S.value),(e=>{e!==v.params.key&&O.push({name:"relation",params:{type:V.value,key:e}})})),b((()=>[v.params.type,v.params.key]),(()=>{V.value=v.params.type,S.value=v.params.key,z.splice(0,z.length),J.splice(0,J.length),q(),le("all",V.value,S.value)}));const se=h({position:"absolute",zIndex:65535,top:"0px",left:"0px",display:"none"}),re=p(),ie=p(!1),ce=p(!1),ne=p(""),ue=p(""),de=(e,t)=>{var a;switch(se.top=t.clientY+"px",se.left=t.clientX+"px",se.display="block",null==(a=re.value)||a.handleOpen(),e.type){case"risk":w.risk.disableContextMenu.value=!0,w.avoidance.disableContextMenu.value=!1,w["attack-tool"].disableContextMenu.value=!1,w["threat-actor"].disableContextMenu.value=!1,w["ability-provider"].disableContextMenu.value=!0,ie.value=!1,ce.value=!1;break;case"avoidance":w.risk.disableContextMenu.value=!1,w.avoidance.disableContextMenu.value=!0,w["attack-tool"].disableContextMenu.value=!0,w["threat-actor"].disableContextMenu.value=!0,w["ability-provider"].disableContextMenu.value=!1,ie.value=!1,ce.value=!1;break;case"attack-tool":w.risk.disableContextMenu.value=!1,w.avoidance.disableContextMenu.value=!1,w["attack-tool"].disableContextMenu.value=!0,w["threat-actor"].disableContextMenu.value=!1,w["ability-provider"].disableContextMenu.value=!0,ie.value=!1,ce.value=!1;break;case"threat-actor":w.risk.disableContextMenu.value=!1,w.avoidance.disableContextMenu.value=!0,w["attack-tool"].disableContextMenu.value=!1,w["threat-actor"].disableContextMenu.value=!0,w["ability-provider"].disableContextMenu.value=!0,ie.value=!1,ce.value=!1;break;case"ability-provider":w.risk.disableContextMenu.value=!0,w.avoidance.disableContextMenu.value=!1,w["attack-tool"].disableContextMenu.value=!0,w["threat-actor"].disableContextMenu.value=!0,w["ability-provider"].disableContextMenu.value=!0,ie.value=!0,ce.value=!1}e.id==S.value&&(ce.value=!0),ne.value=e.type,ue.value=e.id},ve=e=>{le(e,ne.value,ue.value)},pe=p(["risk","avoidance","attack-tool","threat-actor","ability-provider"]),he=p([]),ke=()=>{he.value.splice(0,he.value.length),J.forEach((e=>{he.value.includes(e.text)||he.value.push(e.text)}))},be=p(he.value),fe=()=>{var e,t,a;const o=null==(e=U.value)?void 0:e.getInstance().getNodes(),l=null==(t=U.value)?void 0:t.getInstance().getLinks();null==o||o.forEach((e=>{let t=!1;pe.value.includes(e.type)||(t=!0),e.opacity=t?.1:1})),null==l||l.forEach((e=>{e.relations.forEach((e=>{be.value.includes(e.text)?e.isHide=!1:e.isHide=!0}))})),null==(a=U.value)||a.getInstance().dataUpdated()};return(t,o)=>{const l=r,v=i,p=c,h=n,k=u,b=d,H=s;return C(),f("div",B,[y(m(e),{ref_key:"graphRef$",ref:U,options:N},{node:x((({node:e})=>[T("div",{style:{cursor:"pointer","font-size":"xx-small",display:"flex",height:"inherit","align-items":"center","justify-content":"center"},onDblclick:t=>de(e,t),onContextmenu:t=>de(e,t),innerHTML:e.text},null,40,R)])),"graph-plug":x((()=>[T("div",K,[T("div",null,[y(v,{style:{width:"200px"},modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=e=>V.value=e)},{default:x((()=>[(C(),f(E,null,M(w,((e,t)=>y(l,{label:e.title,key:t,value:t},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),T("div",null,[y(v,{style:{width:"200px"},modelValue:S.value,"onUpdate:modelValue":o[1]||(o[1]=e=>S.value=e)},{default:x((()=>[(C(!0),f(E,null,M(m(a)[w[V.value].BreakKey],((e,t)=>(C(),j(l,{key:t,label:t+":"+e.title,value:t},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),I,y(h,{modelValue:pe.value,"onUpdate:modelValue":o[2]||(o[2]=e=>pe.value=e),onChange:fe},{default:x((()=>[(C(),f(E,null,M(w,((e,t)=>y(p,{key:t,name:t,class:"filter-checkbox",label:t,value:t},{default:x((()=>[_(g(e.title),1)])),_:2},1032,["name","label","value"]))),64))])),_:1},8,["modelValue"])]),T("div",P,[D,y(h,{modelValue:be.value,"onUpdate:modelValue":o[3]||(o[3]=e=>be.value=e),onChange:fe},{default:x((()=>[(C(!0),f(E,null,M(he.value,(e=>(C(),j(p,{class:"filter-checkbox",key:e,label:e,name:e},{default:x((()=>[_(g(e),1)])),_:2},1032,["label","name"])))),128))])),_:1},8,["modelValue"])])])),_:1},8,["options"]),y(H,{ref_key:"dropdown1",ref:re,handleOpen:!0,style:A(se)},{dropdown:x((()=>[y(b,null,{default:x((()=>[(C(),f(E,null,M(w,((e,t)=>y(k,{key:t,onClick:e=>ve(t),disabled:e.disableContextMenu.value},{default:x((()=>[_(g(e.title),1)])),_:2},1032,["onClick","disabled"]))),64)),y(k,{onClick:o[4]||(o[4]=e=>ve("all")),disabled:ie.value},{default:x((()=>[_("拉取全部关系")])),_:1},8,["disabled"]),y(k,{onClick:o[5]||(o[5]=e=>{O.push({name:"relation",params:{type:ne.value,key:ue.value}})}),disabled:ce.value,divided:""},{default:x((()=>[_("作为根节点打开")])),_:1},8,["disabled"]),y(k,{divided:"",onClick:o[6]||(o[6]=e=>(()=>{let e="";switch(ne.value){case"risk":return e="riskDetail",void O.push({name:e,params:{rKey:ue.value}});case"avoidance":e="avoidances";break;case"attack-tool":e="attackTools";break;case"threat-actor":e="threatActors";break;case"ability-provider":e="abilityProviders"}O.push({name:e,hash:"#"+ue.value})})())},{default:x((()=>[_("查看详细描述")])),_:1})])),_:1})])),default:x((()=>[L])),_:1},8,["style"])])}}}),[["__scopeId","data-v-701a889d"]]);export{S as default};
